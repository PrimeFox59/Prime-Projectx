{% extends 'base.html' %}
{% block content %}
<section class="panel quote-detail">
    <div class="proposal-main">
        <p class="eyebrow">{{ t('quote_page_title') }}</p>
        <h1>{{ quote.project_name }}</h1>
        {% if session.get('admin_auth') or is_full_access %}
        <p class="lede">{{ t('quote_label_client') }}: <strong>{{ quote.client_name }}</strong> | {{ t('quote_label_status') }}: <span class="status-badge {{ quote.status|lower }}">{{ quote.status }}</span> | {{ t('quote_label_created') }}: {{ quote.created_at }}</p>
        {% endif %}

        <!-- Basic Info -->
        <div class="proposal-section">
            <h3>{{ t('quote_label_scope') }}</h3>
            <p style="white-space: pre-line;">{{ quote.scope }}</p>
        </div>

        <!-- Technical Approach -->
        {% if quote.technical_approach %}
        <div class="proposal-section">
            <h3>ğŸ”§ Technical Approach</h3>
            <p style="white-space: pre-line;">{{ quote.technical_approach }}</p>
        </div>
        {% endif %}

        <!-- Tech Stack -->
        {% if quote.tech_stack and (session.get('admin_auth') or is_full_access) %}
        <div class="proposal-section">
            <h3>ğŸ’» Technology Stack</h3>
            <p style="white-space: pre-line;">{{ quote.tech_stack }}</p>
        </div>
        {% endif %}

        <!-- Deliverables -->
        {% if quote.deliverables %}
        <div class="proposal-section">
            <h3>ğŸ“¦ Deliverables</h3>
            <p style="white-space: pre-line;">{{ quote.deliverables }}</p>
        </div>
        {% endif %}

        <!-- Timeline -->
        {% if quote.timeline %}
        <div class="proposal-section">
            <h3>ğŸ“… Project Timeline</h3>
            <p style="white-space: pre-line;">{{ quote.timeline }}</p>
        </div>
        {% endif %}

        <!-- Team Structure -->
        {% if quote.team_structure and (session.get('admin_auth') or is_full_access) %}
        <div class="proposal-section">
            <h3>ğŸ‘¥ Team Structure</h3>
            <p style="white-space: pre-line;">{{ quote.team_structure }}</p>
        </div>
        {% endif %}

        <!-- Assumptions -->
        {% if quote.assumptions and (session.get('admin_auth') or is_full_access) %}
        <div class="proposal-section">
            <h3>ğŸ“‹ Assumptions & Dependencies</h3>
            <p style="white-space: pre-line;">{{ quote.assumptions }}</p>
        </div>
        {% endif %}

        <!-- Payment Terms -->
        {% if quote.payment_terms and (session.get('admin_auth') or is_full_access) %}
        <div class="proposal-section">
            <h3>ğŸ’° Payment Terms</h3>
            <p style="white-space: pre-line;">{{ quote.payment_terms }}</p>
        </div>
        {% endif %}

        <div class="actions">
            <a class="btn primary" href="/">Back to landing</a>
        </div>
    </div>

    <aside class="proposal-side">
        {% if session.get('admin_auth') or is_full_access %}
        <div class="side-card">
            <div class="proposal-section investment" style="margin: 0 0 12px;">
                <h3 style="margin-bottom: 6px;">{{ t('quote_label_amount') }}</h3>
                <div class="amount">Rp {{ '{:,.0f}'.format(quote.amount) }}</div>
            </div>

            <div class="qr-card">
                <img src="{{ url_for('qr_image', token=quote.token) }}" alt="QR for quotation">
                <p>{{ t('quote_qr_title') }}</p>
                <div style="display: grid; gap: 8px; margin-top: 12px;">
                    <a class="btn ghost" href="{{ quote.url }}" target="_blank" style="font-size: 10px; padding: 8px 10px;">Open link</a>
                    <div style="display: flex; gap: 8px;">
                        <a class="btn ghost" href="{{ url_for('invoice_pdf', token=quote.token) }}" style="flex: 1; font-size: 10px; padding: 8px 10px;">Invoice PDF</a>
                        <a class="btn ghost" href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Discussion: {{ quote.project_name|urlencode }}&details=Project proposal discussion with Prime Projectx%0A%0AProposal: {{ quote.url|urlencode }}&location=Google Meet&add=primetroyxs@gmail.com" target="_blank" style="flex: 1; font-size: 10px; padding: 8px 10px;">{{ t('quote_schedule_btn') }}</a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="proposal-meta contact-card">
            <h4>Contact</h4>
            <div class="contact-links">
                <a href="https://wa.me/6289524257778" target="_blank">ğŸ“± +62 895-2425-7778</a>
                <a href="mailto:primetroyxs@gmail.com">âœ‰ï¸ primetroyxs@gmail.com</a>
                <a href="https://www.linkedin.com/in/galihprime/" target="_blank">ğŸ”— LinkedIn</a>
            </div>
        </div>
    </aside>
</section>
{% endblock %}
